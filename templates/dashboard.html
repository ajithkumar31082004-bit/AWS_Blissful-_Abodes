{% extends "layout.html" %}

{% block title %}Guest Dashboard - Blissful Abodes India{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboards.css') }}">
<style>
    .loyalty-progress {
        background: rgba(255,255,255,0.2);
        height: 12px;
        border-radius: 6px;
        margin: 15px 0;
        overflow: hidden;
    }
    .loyalty-bar {
        background: var(--secondary-gradient);
        height: 100%;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="dashboard-hero">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-7">
                    <h1>Namaste, {{ user.name }}! üôè</h1>
                    <p>Welcome back to your premium sanctuary. You have <strong>{{ stats.upcoming if stats else 0 }}</strong> upcoming luxury stays.</p>
                    
                    <div class="stats-grid mt-4">
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-label" style="font-size: 0.7rem;">Upcoming</div>
                            <div class="stat-value" style="font-size: 1.5rem;">{{ stats.upcoming if stats else 0 }}</div>
                        </div>
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-label" style="font-size: 0.7rem;">Past Stays</div>
                            <div class="stat-value" style="font-size: 1.5rem;">{{ stats.past if stats else 0 }}</div>
                        </div>
                        <div class="stat-card" style="padding: 15px;">
                            <div class="stat-label" style="font-size: 0.7rem;">Total Spent</div>
                            <div class="stat-value" style="font-size: 1.5rem;">‚Çπ{{ "{:,.0f}".format(stats.total_spent if stats and stats.total_spent else 0) }}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="glass-card" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                        <div class="d-flex justify-content-between">
                            <h4>Blissful Loyalty</h4>
                            <span class="badge" style="background: var(--secondary-gradient); color: #1a365d;">{{ loyalty_tier if loyalty_tier else 'Silver' }} Member</span>
                        </div>
                        <div class="stat-value text-white mt-3">{{ loyalty_points if loyalty_points else 0 }} Points</div>
                        <div class="loyalty-progress">
                            <div class="loyalty-bar" style="width: {{ (loyalty_points % 5000) / 50 }}%;"></div>
                        </div>
                        <small>Earn 500 more points for <strong>Gold</strong> tier!</small>
                        <button class="btn-primary w-100 mt-3" style="background: white; color: var(--primary);">REDEEM REWARDS</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-content container">
        <div class="row">
            <div class="col-md-8">
                <!-- Upcoming Bookings -->
                <div class="dashboard-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">Upcoming Stays</h2>
                        <a href="{{ url_for('rooms') }}" class="btn-primary btn-small"><i class="fas fa-plus"></i> NEW BOOKING</a>
                    </div>
                    
                    {% if upcoming_bookings %}
                        {% for booking in upcoming_bookings %}
                        <div class="glass-card mb-3">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <div class="stat-icon" style="background: var(--accent-gradient);"><i class="fas fa-hotel"></i></div>
                                </div>
                                <div class="col">
                                    <h4>{{ booking.room_name }}</h4>
                                    <p class="mb-0 text-muted"><i class="fas fa-map-marker-alt"></i> {{ booking.branch_name if booking.branch_name else 'Premium Branch' }}</p>
                                    <small class="text-primary">{{ booking.check_in }} ‚Äî {{ booking.check_out }}</small>
                                </div>
                                <div class="col-auto">
                                    <div class="d-flex flex-column gap-2">
                                        <button class="btn-primary btn-small">VIEW VOUCHER</button>
                                        <button class="btn-text btn-small">MODIFY</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="glass-card text-center p-5">
                            <i class="fas fa-calendar-plus fa-3x mb-3 text-muted"></i>
                            <h3>No upcoming stays yet</h3>
                            <p>Discover our bespoke collections across 5 major Indian cities.</p>
                            <a href="{{ url_for('rooms') }}" class="btn-primary mt-3">EXPLORE ROOMS</a>
                        </div>
                    {% endif %}
                </div>

                <!-- Itinerary Visualization (if multi-city) -->
                {% if upcoming_bookings|length > 1 %}
                <div class="dashboard-section fade-in">
                    <h2 class="section-title">Travel Itinerary</h2>
                    <div class="glass-card mt-3">
                        <div class="d-flex gap-4 overflow-x-auto p-2">
                            {% for booking in upcoming_bookings %}
                            <div class="text-center" style="min-width: 150px;">
                                <div class="stat-icon m-auto mb-2" style="width: 40px; height: 40px; font-size: 1rem;"><i class="fas fa-plane"></i></div>
                                <small class="d-block">{{ booking.check_in }}</small>
                                <strong>{{ booking.branch_name }}</strong>
                            </div>
                            {% if not loop.last %}<div class="align-self-center"><i class="fas fa-arrow-right text-muted"></i></div>{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="col-md-4">
                <!-- Branch Quick Navigation -->
                <div class="glass-card mb-4">
                    <h3>Explore Branches üáÆüá≥</h3>
                    <div class="d-grid gap-2 mt-3">
                        <a href="{{ url_for('rooms', branch_id='BLISS-MUM') }}" class="btn btn-outline-primary text-left p-3 d-flex justify-content-between">
                            <span>Mumbai (Corporate)</span> <i class="fas fa-chevron-right"></i>
                        </a>
                        <a href="{{ url_for('rooms', branch_id='BLISS-DEL') }}" class="btn btn-outline-primary text-left p-3 d-flex justify-content-between">
                            <span>Delhi (Heritage)</span> <i class="fas fa-chevron-right"></i>
                        </a>
                        <a href="{{ url_for('rooms', branch_id='BLISS-GOA') }}" class="btn btn-outline-primary text-left p-3 d-flex justify-content-between">
                            <span>Goa (Resort)</span> <i class="fas fa-chevron-right"></i>
                        </a>
                    </div>
                </div>

                <!-- India Specific Payment Support -->
                <div class="glass-card">
                    <h3>Payment Methods</h3>
                    <div class="d-flex gap-3 mt-3 opacity-50 grayscale">
                        <i class="fab fa-cc-visa fa-2x"></i>
                        <i class="fab fa-cc-mastercard fa-2x"></i>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/UPI-Logo-vector.svg/512px-UPI-Logo-vector.svg.png" height="20" alt="UPI">
                    </div>
                    <p class="small text-muted mt-3">All payments are secured with 18% GST invoice generation.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
