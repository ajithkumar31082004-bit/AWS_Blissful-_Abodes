{% extends "layout.html" %}
{% block title %}Staff Dashboard - {{ branch.branch_name if branch.branch_name else branch.get('branch_name', 'Branch') }}{% endblock %}

{% block extra_css %}
<style>
  .dashboard {
    min-height: calc(100vh - 200px);
    background: #f8f9fa;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #1a365d, #2d9cdb);
    color: white;
    padding: 60px 20px 40px;
    border-radius: 0 0 30px 30px;
    margin-bottom: 40px;
  }

  .dashboard-header h1 {
    font-family: "Playfair Display", serif;
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 40px;
  }

  .today-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    text-align: center;
  }

  .stat-card .icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }

  .stat-card .number {
    font-size: 2rem;
    font-weight: 700;
    color: #1a365d;
    margin-bottom: 5px;
  }

  .section-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    margin-bottom: 30px;
  }

  .section-card h2 {
    color: #1a365d;
    font-family: "Playfair Display", serif;
    margin-bottom: 20px;
    font-size: 1.8rem;
  }

  .booking-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .booking-card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid #2d9cdb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }

  .booking-info h4 {
    color: #1a365d;
    margin-bottom: 5px;
  }

  .booking-info p {
    color: #666;
    margin: 5px 0;
    font-size: 0.9rem;
  }

  .badge {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .badge-success {
    background: #d4edda;
    color: #155724;
  }

  .badge-warning {
    background: #fff3cd;
    color: #856404;
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="dashboard-container">
      <h1>üë®‚Äçüíº {{ branch.branch_name if branch.branch_name else branch.get('branch_name', 'Branch') }} - Staff Dashboard</h1>
      <p style="font-size: 1.1rem; opacity: 0.9;">
        {% if branch.location %}
          üìç {{ branch.location.city if branch.location else branch.get('location', {}).get('city', '') }}
        {% endif %}
      </p>
    </div>
  </div>

  <div class="dashboard-container">
    <!-- Today's Operations -->
    <div class="section-card">
      <h2>üìÖ Today's Operations</h2>
      <div class="today-stats">
        <div class="stat-card">
          <div class="icon">‚úÖ</div>
          <div class="number">{{ today_check_ins|length }}</div>
          <div class="label">Check-ins</div>
        </div>
        <div class="stat-card">
          <div class="icon">üö™</div>
          <div class="number">{{ today_check_outs|length }}</div>
          <div class="label">Check-outs</div>
        </div>
        <div class="stat-card">
          <div class="icon">üìã</div>
          <div class="number">{{ upcoming_check_ins|length }}</div>
          <div class="label">Upcoming (3 days)</div>
        </div>
      </div>
    </div>

    <!-- Today's Check-ins -->
    {% if today_check_ins %}
    <div class="section-card">
      <h2>‚úÖ Today's Check-ins</h2>
      <div class="booking-list">
        {% for booking in today_check_ins %}
        <div class="booking-card">
          <div class="booking-info">
            <h4>{{ booking.guest_name if booking.guest_name else booking.get('guest_name', 'Guest') }}</h4>
            <p><i class="fas fa-envelope"></i> {{ booking.guest_email if booking.guest_email else booking.get('guest_email', '') }}</p>
            <p><i class="fas fa-calendar"></i> Check-in: {{ booking.check_in if booking.check_in else booking.get('check_in', '') }}</p>
            <p><i class="fas fa-calendar-times"></i> Check-out: {{ booking.check_out if booking.check_out else booking.get('check_out', '') }}</p>
          </div>
          <div>
            <span class="badge badge-success">{{ booking.booking_status if booking.booking_status else booking.get('booking_status', 'confirmed')|title }}</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Today's Check-outs -->
    {% if today_check_outs %}
    <div class="section-card">
      <h2>üö™ Today's Check-outs</h2>
      <div class="booking-list">
        {% for booking in today_check_outs %}
        <div class="booking-card">
          <div class="booking-info">
            <h4>{{ booking.guest_name if booking.guest_name else booking.get('guest_name', 'Guest') }}</h4>
            <p><i class="fas fa-envelope"></i> {{ booking.guest_email if booking.guest_email else booking.get('guest_email', '') }}</p>
            <p><i class="fas fa-calendar-times"></i> Check-out: {{ booking.check_out if booking.check_out else booking.get('check_out', '') }}</p>
          </div>
          <div>
            <span class="badge badge-warning">Check-out Today</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Upcoming Check-ins -->
    {% if upcoming_check_ins %}
    <div class="section-card">
      <h2>üìÖ Upcoming Check-ins (Next 3 Days)</h2>
      <div class="booking-list">
        {% for booking in upcoming_check_ins %}
        <div class="booking-card">
          <div class="booking-info">
            <h4>{{ booking.guest_name if booking.guest_name else booking.get('guest_name', 'Guest') }}</h4>
            <p><i class="fas fa-calendar"></i> Check-in: {{ booking.check_in if booking.check_in else booking.get('check_in', '') }}</p>
            <p><i class="fas fa-calendar-times"></i> Check-out: {{ booking.check_out if booking.check_out else booking.get('check_out', '') }}</p>
          </div>
          <div>
            <span class="badge badge-success">Upcoming</span>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="section-card">
      <h2>‚ö° Quick Actions</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <a href="{{ url_for('staff_dashboard') }}" 
           class="btn-primary" style="text-align: center; text-decoration: none; display: block; padding: 15px;">
          <i class="fas fa-bed"></i> Update Room Status
        </a>
        <a href="{{ url_for('rooms', branch_id=branch.branch_id if branch.branch_id else branch.get('branch_id', '')) }}" 
           class="btn-secondary" style="text-align: center; text-decoration: none; display: block; padding: 15px;">
          <i class="fas fa-list"></i> View All Rooms
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
