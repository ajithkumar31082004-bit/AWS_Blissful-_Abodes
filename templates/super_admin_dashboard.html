{% extends "layout.html" %}

{% block title %}Super Admin Dashboard - Blissful Abodes India{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboards.css') }}">
<style>
    .branch-card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }
    .branch-summary-card {
        padding: 25px;
    }
    .performance-badge {
        font-size: 0.75rem;
        padding: 4px 10px;
        border-radius: 4px;
        font-weight: 700;
        margin-left: 10px;
    }
    .top-performer { background: #dcfce7; color: #166534; }
    .needs-attention { background: #fee2e2; color: #991b1b; }
    
    .mega-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    
    .mega-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        border-bottom: 4px solid var(--primary);
    }
    
    .mega-card .label { font-size: 0.8rem; color: #666; text-transform: uppercase; margin-bottom: 5px; }
    .mega-card .value { font-size: 1.5rem; font-weight: 800; color: #1a365d; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page overflow-x-hidden">
    <div class="dashboard-hero">
        <div class="container">
            <h1>Executive Command Center üáÆüá≥</h1>
            <p>Super Admin | Blissful Abodes India | 5 Branches | 500+ Rooms</p>
            
            <div class="mega-stats mt-4">
                <div class="mega-card">
                    <div class="label">Total Revenue (MTD)</div>
                    <div class="value">‚Çπ{{ "{:,.0f}".format(total_revenue if total_revenue else 21100000) }}</div>
                </div>
                <div class="mega-card">
                    <div class="label">Overall Occupancy</div>
                    <div class="value">83%</div>
                </div>
                <div class="mega-card">
                    <div class="label">Active Guests</div>
                    <div class="value">823</div>
                </div>
                <div class="mega-card">
                    <div class="label">System Health</div>
                    <div class="value" style="color: var(--success);">100% OK</div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-content container">
        <!-- Branch Matrix -->
        <div class="dashboard-section fade-in">
            <div class="section-header">
                <h2 class="section-title">Branch Performance Matrix</h2>
                <div class="badge badge-primary">LIVE DATA</div>
            </div>
            
            <div class="glass-card">
                <div style="overflow-x: auto;">
                    <table class="premium-table">
                        <thead>
                            <tr>
                                <th>Branch</th>
                                <th>Rooms</th>
                                <th>Occupancy</th>
                                <th>Revenue</th>
                                <th>Avg. Rating</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for branch_id, stats in branch_analytics.items() %}
                            <tr>
                                <td>
                                    <strong>{{ stats.branch_name }}</strong>
                                    {% if loop.first %}<span class="performance-badge top-performer">EXCELENT</span>{% endif %}
                                    {% if loop.index == 2 %}<span class="performance-badge needs-attention">LOW OCCUPANCY</span>{% endif %}
                                </td>
                                <td>{{ stats.total_rooms }}</td>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="progress" style="height: 8px; width: 100px; background: #eee; border-radius: 4px; overflow: hidden;">
                                            <div class="progress-bar" style="width: {{ stats.occupancy_rate }}%; height: 100%; background: var(--primary);"></div>
                                        </div>
                                        <span>{{ stats.occupancy_rate }}%</span>
                                    </div>
                                </td>
                                <td>‚Çπ{{ "{:,.0f}".format(stats.total_revenue) }}</td>
                                <td>
                                    <span style="color: #f59e0b;"><i class="fas fa-star"></i> {{ stats.avg_rating }}</span>
                                </td>
                                <td><span class="status-pill status-available">ACTIVE</span></td>
                                <td><a href="#" class="btn-small btn-primary">MANAGE</a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- System Intelligence -->
        <div class="row mt-4">
            <div class="col-md-7">
                <div class="glass-card h-100">
                    <h3 class="mb-4">Revenue Trend (AI Forecast)</h3>
                    <div style="height: 300px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 15px;">
                        <p class="text-muted"><i class="fas fa-chart-line fa-3x mb-3 d-block text-center"></i> Analytics Graph Placeholder - ML Predication Active</p>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="glass-card h-100">
                    <h3 class="mb-4">Recent Critical Alerts</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li class="p-3 mb-2 rounded" style="background: #fff5f5; border-left: 4px solid #f87171;">
                            <div class="d-flex justify-content-between">
                                <strong>‚ö†Ô∏è Delhi Branch</strong>
                                <small>2m ago</small>
                            </div>
                            <p class="mb-0 small">Occupancy dropped below 80% protocol.</p>
                        </li>
                        <li class="p-3 mb-2 rounded" style="background: #fffbeb; border-left: 4px solid #fbbf24;">
                            <div class="d-flex justify-content-between">
                                <strong>‚ÑπÔ∏è Maintenance</strong>
                                <small>15m ago</small>
                            </div>
                            <p class="mb-0 small">Goa Pool maintenance approved.</p>
                        </li>
                    </ul>
                    <a href="#" class="btn-text mt-3">View All Logs <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <!-- User Administration -->
        <div class="dashboard-section mt-5">
            <div class="section-header">
                <h2 class="section-title">Access Control Matrix</h2>
                <div class="action-buttons">
                    <button class="btn-primary btn-small"><i class="fas fa-plus"></i> ADD ADMIN</button>
                </div>
            </div>
            <div class="branch-card-grid">
                <div class="glass-card">
                    <h4>Regional Administrators</h4>
                    <p class="small text-muted">5 Active Branch Administrators</p>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Amit Shah (Mumbai)</span>
                        <span class="role-badge role-admin">ADMIN</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Neha Roy (Delhi)</span>
                        <span class="role-badge role-admin">ADMIN</span>
                    </div>
                    <a href="#" class="btn-text btn-small mt-3">Manage Users</a>
                </div>
                <div class="glass-card">
                    <h4>Infrastructure Health</h4>
                    <div class="mb-3">
                        <small>AWS DynamoDB</small>
                        <div class="status-pill status-available w-100 text-center mt-1">HEALTHY</div>
                    </div>
                    <div class="mb-3">
                        <small>Payment Gateway (Razorpay)</small>
                        <div class="status-pill status-available w-100 text-center mt-1">CONNECTED</div>
                    </div>
                    <div class="mb-3">
                        <small>Email Service (SNS)</small>
                        <div class="status-pill status-available w-100 text-center mt-1">ACTIVE</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
