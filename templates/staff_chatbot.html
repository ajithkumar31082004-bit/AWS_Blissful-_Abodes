{% extends "base.html" %} {% block title %}Staff Service Requests - Blissful
Abodes{% endblock %} {% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="mb-3">
                <i class="fas fa-concierge-bell"></i> Staff Service Dashboard
            </h2>
            <p class="text-muted">
                Manage guest service requests and view available services
            </p>
        </div>
        <div class="col-md-4 text-end">
            <button
                class="btn btn-primary btn-lg"
                onclick="showServicesModal()"
            >
                <i class="fas fa-list"></i> View All Services
            </button>
            <button class="btn btn-success btn-lg" onclick="openStaffChat()">
                <i class="fas fa-comments"></i> Staff Chat
            </button>
        </div>
    </div>

    <!-- Services We Provide Section -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-concierge-bell"></i> Services We
                        Provide
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i
                                    class="fas fa-utensils fa-3x text-primary"
                                ></i>
                                <h6 class="mt-2">Room Service</h6>
                                <small class="text-muted"
                                    >24/7 Food & Beverages</small
                                >
                            </div>
                        </div>
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i class="fas fa-spa fa-3x text-success"></i>
                                <h6 class="mt-2">Spa & Wellness</h6>
                                <small class="text-muted"
                                    >Massage & Treatments</small
                                >
                            </div>
                        </div>
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i
                                    class="fas fa-hamburger fa-3x text-warning"
                                ></i>
                                <h6 class="mt-2">Restaurant</h6>
                                <small class="text-muted"
                                    >Dining Reservations</small
                                >
                            </div>
                        </div>
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i class="fas fa-tshirt fa-3x text-info"></i>
                                <h6 class="mt-2">Laundry</h6>
                                <small class="text-muted"
                                    >Wash & Iron Service</small
                                >
                            </div>
                        </div>
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i class="fas fa-taxi fa-3x text-danger"></i>
                                <h6 class="mt-2">Transportation</h6>
                                <small class="text-muted"
                                    >Airport & City Transfers</small
                                >
                            </div>
                        </div>
                        <div class="col-md-2 text-center mb-3">
                            <div class="service-icon">
                                <i
                                    class="fas fa-map-marked-alt fa-3x text-secondary"
                                ></i>
                                <h6 class="mt-2">Tours</h6>
                                <small class="text-muted"
                                    >City & Cultural Tours</small
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <div
                        class="d-flex justify-content-between align-items-center"
                    >
                        <div>
                            <h6 class="card-title text-uppercase mb-0">
                                Pending Services
                            </h6>
                            <h2 class="mt-2 mb-0">
                                {{ pending_services|length }}
                            </h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <div
                        class="d-flex justify-content-between align-items-center"
                    >
                        <div>
                            <h6 class="card-title text-uppercase mb-0">
                                In Progress
                            </h6>
                            <h2 class="mt-2 mb-0">
                                {{ processing_services|length }}
                            </h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-spinner"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div
                        class="d-flex justify-content-between align-items-center"
                    >
                        <div>
                            <h6 class="card-title text-uppercase mb-0">
                                Completed Today
                            </h6>
                            <h2 class="mt-2 mb-0">
                                {{ completed_services|length }}
                            </h2>
                        </div>
                        <div class="fs-1">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Type Breakdown -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i> Service Types Breakdown
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-2">
                            <i class="fas fa-utensils text-primary fs-3"></i>
                            <h6 class="mt-2">Room Service</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'room_service')|list|length }}
                            </h4>
                        </div>
                        <div class="col-md-2">
                            <i class="fas fa-spa text-success fs-3"></i>
                            <h6 class="mt-2">Spa & Wellness</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'spa')|list|length }}
                            </h4>
                        </div>
                        <div class="col-md-2">
                            <i class="fas fa-hamburger text-warning fs-3"></i>
                            <h6 class="mt-2">Restaurant</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'restaurant')|list|length }}
                            </h4>
                        </div>
                        <div class="col-md-2">
                            <i class="fas fa-tshirt text-info fs-3"></i>
                            <h6 class="mt-2">Laundry</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'laundry')|list|length }}
                            </h4>
                        </div>
                        <div class="col-md-2">
                            <i class="fas fa-taxi text-danger fs-3"></i>
                            <h6 class="mt-2">Transportation</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'transportation')|list|length }}
                            </h4>
                        </div>
                        <div class="col-md-2">
                            <i
                                class="fas fa-map-marked-alt text-secondary fs-3"
                            ></i>
                            <h6 class="mt-2">Tours</h6>
                            <h4>
                                {{
                                all_service_requests|selectattr('details.service_type',
                                'equalto', 'tour')|list|length }}
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs for Different Request States -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" role="tablist">
                        <li class="nav-item">
                            <a
                                class="nav-link active"
                                id="pending-tab"
                                data-bs-toggle="tab"
                                href="#pending"
                                role="tab"
                            >
                                <i class="fas fa-clock"></i> Pending ({{
                                pending_services|length }})
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                id="processing-tab"
                                data-bs-toggle="tab"
                                href="#processing"
                                role="tab"
                            >
                                <i class="fas fa-spinner"></i> In Progress ({{
                                processing_services|length }})
                            </a>
                        </li>
                        <li class="nav-item">
                            <a
                                class="nav-link"
                                id="completed-tab"
                                data-bs-toggle="tab"
                                href="#completed"
                                role="tab"
                            >
                                <i class="fas fa-check-circle"></i> Completed
                                ({{ completed_services|length }})
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        <!-- Pending Requests Tab -->
                        <div
                            class="tab-pane fade show active"
                            id="pending"
                            role="tabpanel"
                        >
                            <div class="row">
                                {% for req in
                                pending_services|sort(attribute='created_at',
                                reverse=True) %}
                                <div class="col-md-6 mb-3">
                                    <div class="card border-warning">
                                        <div
                                            class="card-header bg-warning bg-opacity-10"
                                        >
                                            <div
                                                class="d-flex justify-content-between align-items-center"
                                            >
                                                <strong
                                                    ><i
                                                        class="fas fa-{{ getServiceIcon(req.details.service_type) }}"
                                                    ></i>
                                                    {{
                                                    req.details.service_type|replace('_',
                                                    ' ')|title }}</strong
                                                >
                                                <span
                                                    class="badge bg-warning text-dark"
                                                    >Pending</span
                                                >
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <p>
                                                <strong>Room:</strong> {{
                                                req.details.room_number }}
                                            </p>
                                            <p>
                                                <strong>Requested Time:</strong>
                                                {{ req.details.preferred_time or
                                                'ASAP' }}
                                            </p>
                                            <p>
                                                <strong>Details:</strong
                                                ><br />{{ req.details.details }}
                                            </p>
                                            <p class="text-muted mb-0">
                                                <small
                                                    >Created: {{ req.created_at
                                                    }}</small
                                                >
                                            </p>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-flex gap-2">
                                                <button
                                                    class="btn btn-info btn-sm flex-fill"
                                                    onclick="acceptRequest('{{ req.request_id }}')"
                                                >
                                                    <i
                                                        class="fas fa-hand-paper"
                                                    ></i>
                                                    Accept
                                                </button>
                                                <button
                                                    class="btn btn-primary btn-sm flex-fill"
                                                    onclick="viewRequestDetail('{{ req.request_id }}')"
                                                >
                                                    <i class="fas fa-eye"></i>
                                                    View
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %} {% if pending_services|length == 0
                                %}
                                <div class="col-md-12">
                                    <div class="alert alert-info text-center">
                                        <i class="fas fa-info-circle"></i> No
                                        pending service requests at the moment.
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Processing Requests Tab -->
                        <div
                            class="tab-pane fade"
                            id="processing"
                            role="tabpanel"
                        >
                            <div class="row">
                                {% for req in
                                processing_services|sort(attribute='updated_at',
                                reverse=True) %}
                                <div class="col-md-6 mb-3">
                                    <div class="card border-info">
                                        <div
                                            class="card-header bg-info bg-opacity-10"
                                        >
                                            <div
                                                class="d-flex justify-content-between align-items-center"
                                            >
                                                <strong
                                                    ><i
                                                        class="fas fa-{{ getServiceIcon(req.details.service_type) }}"
                                                    ></i>
                                                    {{
                                                    req.details.service_type|replace('_',
                                                    ' ')|title }}</strong
                                                >
                                                <span class="badge bg-info"
                                                    >In Progress</span
                                                >
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <p>
                                                <strong>Room:</strong> {{
                                                req.details.room_number }}
                                            </p>
                                            <p>
                                                <strong>Requested Time:</strong>
                                                {{ req.details.preferred_time or
                                                'ASAP' }}
                                            </p>
                                            <p>
                                                <strong>Details:</strong
                                                ><br />{{ req.details.details }}
                                            </p>
                                            {% if req.staff_assigned %}
                                            <p class="text-success">
                                                <strong>Assigned to:</strong> {{
                                                req.staff_assigned }}
                                            </p>
                                            {% endif %}
                                            <p class="text-muted mb-0">
                                                <small
                                                    >Started: {{ req.updated_at
                                                    }}</small
                                                >
                                            </p>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-flex gap-2">
                                                <button
                                                    class="btn btn-success btn-sm flex-fill"
                                                    onclick="completeRequest('{{ req.request_id }}')"
                                                >
                                                    <i class="fas fa-check"></i>
                                                    Mark Complete
                                                </button>
                                                <button
                                                    class="btn btn-primary btn-sm flex-fill"
                                                    onclick="viewRequestDetail('{{ req.request_id }}')"
                                                >
                                                    <i class="fas fa-eye"></i>
                                                    View
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %} {% if processing_services|length ==
                                0 %}
                                <div class="col-md-12">
                                    <div class="alert alert-info text-center">
                                        <i class="fas fa-info-circle"></i> No
                                        services currently in progress.
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Completed Requests Tab -->
                        <div
                            class="tab-pane fade"
                            id="completed"
                            role="tabpanel"
                        >
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Service Type</th>
                                            <th>Room</th>
                                            <th>Details</th>
                                            <th>Completed At</th>
                                            <th>Staff</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for req in
                                        completed_services|sort(attribute='updated_at',
                                        reverse=True) %}
                                        <tr>
                                            <td>
                                                <i
                                                    class="fas fa-{{ getServiceIcon(req.details.service_type) }}"
                                                ></i>
                                                {{
                                                req.details.service_type|replace('_',
                                                ' ')|title }}
                                            </td>
                                            <td>
                                                {{ req.details.room_number }}
                                            </td>
                                            <td>
                                                {{ req.details.details[:50] }}{%
                                                if req.details.details|length >
                                                50 %}...{% endif %}
                                            </td>
                                            <td>
                                                <small
                                                    >{{ req.updated_at }}</small
                                                >
                                            </td>
                                            <td>
                                                {% if req.staff_assigned %}
                                                <small class="text-success"
                                                    >{{ req.staff_assigned[:10]
                                                    }}</small
                                                >
                                                {% else %}
                                                <small class="text-muted"
                                                    >N/A</small
                                                >
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% if completed_services|length == 0 %}
                                <div class="alert alert-info text-center">
                                    <i class="fas fa-info-circle"></i> No
                                    completed services yet.
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Staff Chat Modal -->
<div class="modal fade" id="staffChatModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-comments"></i> Staff Communication
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                ></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Staff Chat:</strong> Communicate with other staff
                    members and admins
                </div>
                <div
                    id="staff-chat-messages"
                    style="
                        height: 400px;
                        overflow-y: auto;
                        background: #f8f9fa;
                        padding: 15px;
                        border-radius: 8px;
                    "
                >
                    <div class="text-center text-muted">
                        <small>Staff chat room</small>
                    </div>
                </div>
                <div class="mt-3">
                    <form id="staff-chat-form" class="d-flex gap-2">
                        <input
                            type="text"
                            id="staff-message-input"
                            class="form-control"
                            placeholder="Type message to staff/admin..."
                            required
                        />
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Services Detail Modal -->
<div class="modal fade" id="servicesModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-list"></i> Complete Services Catalog
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                ></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-utensils"></i> Room Service
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>24/7 In-room dining</li>
                                    <li>Breakfast, lunch, dinner</li>
                                    <li>Snacks and beverages</li>
                                    <li>Special dietary requests</li>
                                    <li>Late-night menu</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >30-45 minutes</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-spa"></i> Spa & Wellness
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>Full body massage</li>
                                    <li>Facial treatments</li>
                                    <li>Aromatherapy</li>
                                    <li>Sauna & steam room</li>
                                    <li>Yoga sessions</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >By appointment</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0">
                                    <i class="fas fa-hamburger"></i> Restaurant
                                    Reservations
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>Multi-cuisine restaurant</li>
                                    <li>Private dining rooms</li>
                                    <li>Special occasion setups</li>
                                    <li>Wine pairing</li>
                                    <li>Chef's special menu</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >Instant confirmation</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-tshirt"></i> Laundry
                                    Service
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>Washing & drying</li>
                                    <li>Dry cleaning</li>
                                    <li>Ironing & pressing</li>
                                    <li>Express service</li>
                                    <li>Shoe cleaning</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >24-hour service</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-danger text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-taxi"></i> Transportation
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>Airport pickup & drop</li>
                                    <li>City transfers</li>
                                    <li>Luxury car rental</li>
                                    <li>Taxi booking</li>
                                    <li>Driver services</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >15-30 minutes</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">
                                <h6 class="mb-0">
                                    <i class="fas fa-map-marked-alt"></i> City
                                    Tours
                                </h6>
                            </div>
                            <div class="card-body">
                                <h6>What we provide:</h6>
                                <ul>
                                    <li>Guided city tours</li>
                                    <li>Historical site visits</li>
                                    <li>Shopping tours</li>
                                    <li>Cultural experiences</li>
                                    <li>Custom itineraries</li>
                                </ul>
                                <h6>Response time:</h6>
                                <p class="mb-0">
                                    <span class="badge bg-success"
                                        >Advance booking</span
                                    >
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Request Detail Modal -->
<div class="modal fade" id="requestDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-info-circle"></i> Service Request Details
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                ></button>
            </div>
            <div class="modal-body" id="request-detail-content">
                <div class="text-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentRequestId = null;

    async function acceptRequest(requestId) {
        if (!confirm('Accept this service request and start processing?')) {
            return;
        }

        try {
            const response = await fetch(`/api/admin/chatbot/request/${requestId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    status: 'processing',
                    staff_assigned: '{{ user.user_id }}'
                })
            });

            const data = await response.json();

            if (data.success) {
                showAlert('success', 'Request accepted! You are now processing this service.');
                setTimeout(() => location.reload(), 1500);
            } else {
                showAlert('danger', 'Error accepting request: ' + data.error);
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('danger', 'Error accepting request');
        }
    }

    async function completeRequest(requestId) {
        if (!confirm('Mark this service as completed?')) {
            return;
        }

        try {
            const response = await fetch(`/api/admin/chatbot/request/${requestId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    status: 'completed'
                })
            });

            const data = await response.json();

            if (data.success) {
                showAlert('success', 'Service marked as completed!');
                setTimeout(() => location.reload(), 1500);
            } else {
                showAlert('danger', 'Error completing request: ' + data.error);
            }
        } catch (error) {
            console.error('Error:', error);
            showAlert('danger', 'Error completing request');
        }
    }

    async function viewRequestDetail(requestId) {
        currentRequestId = requestId;
        const modal = new bootstrap.Modal(document.getElementById('requestDetailModal'));
        modal.show();

        try {
            const response = await fetch(`/api/admin/chatbot/request/${requestId}`);
            const data = await response.json();

            if (data.success) {
                const req = data.request;
                const details = req.details || {};

                let detailsHTML = `
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <h5><i class="fas fa-${getServiceIconJS(details.service_type)}"></i> ${details.service_type ? details.service_type.replace('_', ' ').toUpperCase() : 'Service Request'}</h5>
                        </div>
                    </div>
                    <hr>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Request ID:</strong><br>
                            <code>${req.request_id}</code>
                        </div>
                        <div class="col-md-6">
                            <strong>Status:</strong><br>
                            <span class="badge bg-${getStatusColorJS(req.status)}">${req.status.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Room Number:</strong><br>
                            ${details.room_number || 'N/A'}
                        </div>
                        <div class="col-md-6">
                            <strong>Preferred Time:</strong><br>
                            ${details.preferred_time || 'ASAP'}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <strong>Service Details:</strong><br>
                            <div class="alert alert-light mt-2">
                                ${details.details || 'No details provided'}
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Created:</strong><br>
                            <small>${req.created_at}</small>
                        </div>
                        <div class="col-md-6">
                            <strong>Last Updated:</strong><br>
                            <small>${req.updated_at}</small>
                        </div>
                    </div>
                `;

                if (req.staff_assigned) {
                    detailsHTML += `
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <strong>Assigned Staff:</strong><br>
                                <span class="badge bg-success">${req.staff_assigned}</span>
                            </div>
                        </div>
                    `;
                }

                if (req.admin_notes) {
                    detailsHTML += `
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <strong>Admin Notes:</strong><br>
                                <div class="alert alert-warning mt-2">
                                    ${req.admin_notes}
                                </div>
                            </div>
                        </div>
                    `;
                }

                document.getElementById('request-detail-content').innerHTML = detailsHTML;
            } else {
                document.getElementById('request-detail-content').innerHTML = `
                    <div class="alert alert-danger">
                        Error loading request details: ${data.error}
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('request-detail-content').innerHTML = `
                <div class="alert alert-danger">
                    Error loading request details
                </div>
            `;
        }
    }

    function getServiceIconJS(serviceType) {
        const icons = {
            'room_service': 'utensils',
            'spa': 'spa',
            'restaurant': 'hamburger',
            'laundry': 'tshirt',
            'transportation': 'taxi',
            'tour': 'map-marked-alt',
            'other': 'concierge-bell'
        };
        return icons[serviceType] || 'concierge-bell';
    }

    function getStatusColorJS(status) {
        const colors = {
            'pending': 'warning',
            'processing': 'info',
            'completed': 'success',
            'cancelled': 'secondary'
        };
        return colors[status] || 'secondary';
    }

    function showAlert(type, message) {
        const alertHTML = `
            <div class="alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3" role="alert" style="z-index: 9999; min-width: 300px;">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        document.body.insertAdjacentHTML('afterbegin', alertHTML);
    }

    // Auto-refresh every 30 seconds
    setInterval(() => {
        location.reload();
    }, 30000);

    // Play notification sound for new requests (optional)
    const pendingCount = {{ pending_services|length }};
    if (pendingCount > 0) {
        document.title = `(${pendingCount}) Service Requests - Staff Dashboard`;
    }

    // Show services modal
    function showServicesModal() {
        new bootstrap.Modal(document.getElementById('servicesModal')).show();
    }

    // Open staff chat
    function openStaffChat() {
        new bootstrap.Modal(document.getElementById('staffChatModal')).show();
        loadStaffMessages();
    }

    // Load staff messages
    async function loadStaffMessages() {
        // Placeholder for loading staff chat messages
        const chatDiv = document.getElementById('staff-chat-messages');
        chatDiv.innerHTML += `
            <div class="alert alert-success">
                <strong>System:</strong> Staff chat feature is active. Messages will appear here.
            </div>
        `;
    }

    // Staff chat form
    document.getElementById('staff-chat-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const input = document.getElementById('staff-message-input');
        const message = input.value.trim();

        if (!message) return;

        const chatDiv = document.getElementById('staff-chat-messages');
        const timestamp = new Date().toLocaleString();

        chatDiv.innerHTML += `
            <div class="mb-2">
                <strong class="text-primary">You:</strong> ${message}
                <br><small class="text-muted">${timestamp}</small>
            </div>
        `;

        input.value = '';
        chatDiv.scrollTop = chatDiv.scrollHeight;
    });
</script>

<style>
    .card {
        transition:
            transform 0.2s,
            box-shadow 0.2s;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .badge {
        font-size: 0.9em;
    }

    .nav-tabs .nav-link {
        color: #6c757d;
    }

    .nav-tabs .nav-link.active {
        font-weight: bold;
    }

    .service-icon {
        padding: 20px;
        border-radius: 10px;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }

    .service-icon:hover {
        background: #e9ecef;
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .service-icon i {
        transition: transform 0.3s ease;
    }

    .service-icon:hover i {
        transform: scale(1.1);
    }
</style>

{% endblock %}
