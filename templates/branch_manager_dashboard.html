{% extends "layout.html" %}
{% block title %}Branch Manager Dashboard - {{ branch.branch_name if branch.branch_name else branch.get('branch_name', 'Branch') }}{% endblock %}

{% block extra_css %}
<style>
  .dashboard {
    min-height: calc(100vh - 200px);
    background: #f8f9fa;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #1a365d, #2d9cdb);
    color: white;
    padding: 60px 20px 40px;
    border-radius: 0 0 30px 30px;
    margin-bottom: 40px;
  }

  .dashboard-header h1 {
    font-family: "Playfair Display", serif;
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 40px;
  }

  .today-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    text-align: center;
  }

  .stat-card .icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }

  .stat-card .number {
    font-size: 2rem;
    font-weight: 700;
    color: #1a365d;
    margin-bottom: 5px;
  }

  .stat-card .label {
    color: #666;
    font-size: 0.9rem;
  }

  .section-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    margin-bottom: 30px;
  }

  .section-card h2 {
    color: #1a365d;
    font-family: "Playfair Display", serif;
    margin-bottom: 20px;
    font-size: 1.8rem;
  }

  .room-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .room-type-card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid #2d9cdb;
  }

  .room-type-card h4 {
    color: #1a365d;
    margin-bottom: 10px;
    text-transform: capitalize;
  }

  .occupancy-bar {
    height: 10px;
    background: #e9ecef;
    border-radius: 5px;
    overflow: hidden;
    margin-top: 10px;
  }

  .occupancy-fill {
    height: 100%;
    background: linear-gradient(90deg, #2d9cdb, #1a365d);
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="dashboard-container">
      <h1>üè¢ {{ branch.branch_name if branch.branch_name else branch.get('branch_name', 'Branch') }} - Manager Dashboard</h1>
      <p style="font-size: 1.1rem; opacity: 0.9;">
        {% if branch.location %}
          üìç {{ branch.location.address if branch.location.address else branch.get('location', {}).get('address', '') }}, 
          {{ branch.location.city if branch.location.city else branch.get('location', {}).get('city', '') }}
        {% endif %}
      </p>
    </div>
  </div>

  <div class="dashboard-container">
    <!-- Today's Performance -->
    <div class="section-card">
      <h2>üìÖ Today's Performance</h2>
      <div class="today-stats">
        <div class="stat-card">
          <div class="icon">‚úÖ</div>
          <div class="number">{{ today_check_ins|length }}</div>
          <div class="label">Check-ins</div>
        </div>
        <div class="stat-card">
          <div class="icon">üö™</div>
          <div class="number">{{ today_check_outs|length }}</div>
          <div class="label">Check-outs</div>
        </div>
        <div class="stat-card">
          <div class="icon">üí∞</div>
          <div class="number">‚Çπ{{ "{:,.0f}".format(today_revenue) if today_revenue else 0 }}</div>
          <div class="label">Revenue Today</div>
        </div>
        <div class="stat-card">
          <div class="icon">üìä</div>
          <div class="number">{{ occupancy_rate|round(1) }}%</div>
          <div class="label">Occupancy Rate</div>
        </div>
        <div class="stat-card">
          <div class="icon">üõèÔ∏è</div>
          <div class="number">{{ branch_rooms|length }}</div>
          <div class="label">Total Rooms</div>
        </div>
      </div>
    </div>

    <!-- Room Type Performance -->
    <div class="section-card">
      <h2>üìà Room Type Performance</h2>
      <div class="room-type-grid">
        {% if room_type_performance %}
          {% for room_type, data in room_type_performance.items() %}
          <div class="room-type-card">
            <h4>{{ room_type|title }} Rooms</h4>
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
              <span style="color: #666;">Occupied:</span>
              <span style="font-weight: 600; color: #1a365d;">{{ data.occupied }}/{{ data.total }}</span>
            </div>
            <div class="occupancy-bar">
              <div class="occupancy-fill" style="width: {{ data.occupancy_rate }}%;"></div>
            </div>
            <div style="margin-top: 10px; font-weight: 600; color: #2d9cdb;">
              {{ data.occupancy_rate|round(1) }}% Occupancy
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">
            No room type data available
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="section-card">
      <h2>‚ö° Quick Actions</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <a href="{{ url_for('rooms', branch_id=branch.branch_id if branch.branch_id else branch.get('branch_id', '')) }}" 
           class="btn-primary" style="text-align: center; text-decoration: none; display: block; padding: 15px;">
          <i class="fas fa-bed"></i> Manage Rooms
        </a>
        <a href="{{ url_for('staff_dashboard') }}" 
           class="btn-secondary" style="text-align: center; text-decoration: none; display: block; padding: 15px;">
          <i class="fas fa-calendar"></i> View Bookings
        </a>
        <a href="{{ url_for('branch_detail', branch_id=branch.branch_id if branch.branch_id else branch.get('branch_id', '')) }}" 
           class="btn-primary" style="text-align: center; text-decoration: none; display: block; padding: 15px;">
          <i class="fas fa-building"></i> Branch Details
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
