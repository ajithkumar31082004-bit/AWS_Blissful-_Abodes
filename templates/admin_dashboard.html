{% extends "layout.html" %} {% block title %}Admin Dashboard - Blissful Abodes{%
endblock %} {% block extra_css %}
<style>
    .admin-dashboard {
        min-height: calc(100vh - 200px);
        background: #f8f9fa;
    }

    .admin-header {
        background: linear-gradient(135deg, #1a365d, #2d9cdb);
        color: white;
        padding: 60px 20px 40px;
        border-radius: 0 0 30px 30px;
        margin-bottom: 40px;
    }

    .admin-header-content {
        max-width: 1400px;
        margin: 0 auto;
    }

    .admin-header h1 {
        font-family: "Playfair Display", serif;
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .admin-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .admin-stat-card {
        background: rgba(255, 255, 255, 0.15);
        padding: 25px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        text-align: center;
    }

    .admin-stat-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        opacity: 0.9;
    }

    .admin-stat-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .admin-stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px 40px;
    }

    .dashboard-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
        flex-wrap: wrap;
    }

    .dashboard-tab {
        padding: 12px 30px;
        background: none;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        border-radius: 10px 10px 0 0;
        transition: all 0.3s ease;
        position: relative;
    }

    .dashboard-tab.active {
        color: #1a365d;
    }

    .dashboard-tab.active:after {
        content: "";
        position: absolute;
        bottom: -12px;
        left: 0;
        right: 0;
        height: 3px;
        background: #2d9cdb;
        border-radius: 3px;
    }

    .tab-content {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .dashboard-section {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .section-title {
        font-size: 1.5rem;
        color: #1a365d;
        font-weight: 600;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
    }

    .stat-card {
        padding: 25px;
        background: #f8f9fa;
        border-radius: 15px;
    }

    .stat-card h3 {
        color: #666;
        margin-bottom: 15px;
        font-size: 1rem;
        font-weight: 600;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1a365d;
        margin-bottom: 10px;
    }

    .stat-details {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .stat-row:last-child {
        border-bottom: none;
    }

    .stat-label {
        color: #666;
    }

    .stat-value {
        font-weight: 600;
        color: #1a365d;
    }

    .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .chart-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        border: 2px solid #f0f0f0;
    }

    .chart-card h3 {
        color: #1a365d;
        margin-bottom: 20px;
        font-size: 1.2rem;
    }

    .chart-placeholder {
        height: 300px;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #666;
    }

    .chart-placeholder i {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .data-table th {
        text-align: left;
        padding: 15px;
        background: #f8f9fa;
        color: #333;
        font-weight: 600;
        border-bottom: 2px solid #e9ecef;
    }

    .data-table td {
        padding: 15px;
        border-bottom: 1px solid #f0f0f0;
    }

    .data-table tr:hover {
        background: #f8f9fa;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
    }

    .btn-icon {
        padding: 8px;
        background: none;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        color: #666;
        transition: all 0.3s ease;
    }

    .btn-icon:hover {
        background: #f8f9fa;
        color: #1a365d;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .modal-header h3 {
        color: #1a365d;
        margin: 0;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
    }

    .aws-status {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 15px;
        margin-top: 30px;
    }

    @media (max-width: 1024px) {
        .charts-container {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .admin-header {
            padding: 40px 20px 30px;
        }

        .admin-header h1 {
            font-size: 2rem;
        }

        .admin-stats {
            grid-template-columns: 1fr 1fr;
        }

        .dashboard-tabs {
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .dashboard-tab {
            white-space: nowrap;
        }

        .data-table {
            display: block;
            overflow-x: auto;
        }

        .action-buttons {
            flex-direction: column;
        }
    }
</style>
{% endblock %} {% block content %}
<div class="admin-dashboard">
    <!-- Admin Header -->
    <div class="admin-header">
        <div class="admin-header-content">
            <h1>Admin Dashboard</h1>
            <p>
                Monitor system performance, manage users, and oversee platform
                operations
            </p>

            <div class="admin-stats">
                <div class="admin-stat-card">
                    <div class="admin-stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="admin-stat-number">
                        {% if analytics and analytics.get('users') %} {{
                        analytics.get('users', {}).get('total', 0) }} {% else %}
                        0 {% endif %}
                    </div>
                    <div class="admin-stat-label">Total Users</div>
                </div>

                <div class="admin-stat-card">
                    <div class="admin-stat-icon">
                        <i class="fas fa-bed"></i>
                    </div>
                    <div class="admin-stat-number">
                        {% if analytics and analytics.get('rooms') %} {{
                        analytics.get('rooms', {}).get('total', 0) }} {% else %}
                        0 {% endif %}
                    </div>
                    <div class="admin-stat-label">Total Rooms</div>
                </div>

                <div class="admin-stat-card">
                    <div class="admin-stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="admin-stat-number">
                        {% if analytics and analytics.get('bookings') %} {{
                        analytics.get('bookings', {}).get('total', 0) }} {% else
                        %} 0 {% endif %}
                    </div>
                    <div class="admin-stat-label">Total Bookings</div>
                </div>

                <div class="admin-stat-card">
                    <div class="admin-stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="admin-stat-number">24/7</div>
                    <div class="admin-stat-label">System Uptime</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Tabs -->
        <div class="dashboard-tabs">
            <button class="dashboard-tab active" data-tab="overview">
                <i class="fas fa-tachometer-alt"></i> Overview
            </button>
            <button class="dashboard-tab" data-tab="users">
                <i class="fas fa-users-cog"></i> Users
            </button>
            <button class="dashboard-tab" data-tab="rooms">
                <i class="fas fa-bed"></i> Rooms
            </button>
            <button class="dashboard-tab" data-tab="bookings">
                <i class="fas fa-calendar-alt"></i> Bookings
            </button>
            <button class="dashboard-tab" data-tab="system">
                <i class="fas fa-cog"></i> System
            </button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="overviewTab">
            <!-- Statistics Grid -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">System Overview</h2>
                    <button class="btn-primary" onclick="refreshAnalytics()">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>

                <div class="stats-grid">
                    <!-- User Statistics -->
                    <div class="stat-card">
                        <h3><i class="fas fa-users"></i> User Statistics</h3>
                        <div class="stat-number">
                            {% if analytics and analytics.get('users') %} {{
                            analytics.get('users', {}).get('total', 0) }} {%
                            else %} 0 {% endif %}
                        </div>
                        <div class="stat-details">
                            {% if analytics and analytics.get('users',
                            {}).get('by_role') %} {% for role, count in
                            analytics.get('users', {}).get('by_role',
                            {}).items() %}
                            <div class="stat-row">
                                <span class="stat-label"
                                    >{{ role|title }}s</span
                                >
                                <span class="stat-value">{{ count }}</span>
                            </div>
                            {% endfor %} {% else %}
                            <div class="stat-row">
                                <span class="stat-label">Guests</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Staff</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Admins</span>
                                <span class="stat-value">1</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Room Statistics -->
                    <div class="stat-card">
                        <h3><i class="fas fa-bed"></i> Room Statistics</h3>
                        <div class="stat-number">
                            {% if analytics and analytics.get('rooms') %} {{
                            analytics.get('rooms', {}).get('total', 0) }} {%
                            else %} 0 {% endif %}
                        </div>
                        <div class="stat-details">
                            {% if analytics and analytics.get('rooms',
                            {}).get('by_availability') %} {% for status, count
                            in analytics.get('rooms', {}).get('by_availability',
                            {}).items() %}
                            <div class="stat-row">
                                <span class="stat-label"
                                    >{{ status|title }}</span
                                >
                                <span class="stat-value">{{ count }}</span>
                            </div>
                            {% endfor %} {% else %}
                            <div class="stat-row">
                                <span class="stat-label">Available</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Unavailable</span>
                                <span class="stat-value">0</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Booking Statistics -->
                    <div class="stat-card">
                        <h3>
                            <i class="fas fa-calendar-check"></i> Booking
                            Statistics
                        </h3>
                        <div class="stat-number">
                            {% if analytics and analytics.get('bookings') %} {{
                            analytics.get('bookings', {}).get('total', 0) }} {%
                            else %} 0 {% endif %}
                        </div>
                        <div class="stat-details">
                            {% if analytics and analytics.get('bookings',
                            {}).get('by_status') %} {% for status, count in
                            analytics.get('bookings', {}).get('by_status',
                            {}).items() %}
                            <div class="stat-row">
                                <span class="stat-label"
                                    >{{ status|title }}</span
                                >
                                <span class="stat-value">{{ count }}</span>
                            </div>
                            {% endfor %} {% else %}
                            <div class="stat-row">
                                <span class="stat-label">Confirmed</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Pending</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Cancelled</span>
                                <span class="stat-value">0</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>User Growth</h3>
                        <canvas id="userGrowthChart" style="max-height: 300px;"></canvas>
                        <small style="display: block; text-align: center; margin-top: 10px; color: #999;">Powered by AWS Analytics</small>
                    </div>

                    <div class="chart-card">
                        <h3>Booking Trends</h3>
                        <canvas id="bookingTrendsChart" style="max-height: 300px;"></canvas>
                        <small style="display: block; text-align: center; margin-top: 10px; color: #999;">Real-time data from DynamoDB</small>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="dashboard-section">
                <h2 class="section-title" style="margin-bottom: 25px">
                    Quick Actions
                </h2>

                <div
                    style="
                        display: grid;
                        grid-template-columns: repeat(
                            auto-fit,
                            minmax(200px, 1fr)
                        );
                        gap: 20px;
                    "
                >
                    <button
                        class="action-button"
                        onclick="openCreateRoomModal()"
                    >
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 15px;
                                padding: 20px;
                                background: #f8f9fa;
                                border-radius: 15px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            "
                        >
                            <div
                                style="
                                    width: 50px;
                                    height: 50px;
                                    background: linear-gradient(
                                        135deg,
                                        #1a365d,
                                        #2d9cdb
                                    );
                                    border-radius: 12px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-size: 1.5rem;
                                "
                            >
                                <i class="fas fa-plus"></i>
                            </div>
                            <div style="text-align: left">
                                <div style="font-weight: 600; color: #1a365d">
                                    Create Room
                                </div>
                                <div style="font-size: 0.9rem; color: #666">
                                    Add new room to inventory
                                </div>
                            </div>
                        </div>
                    </button>

                    <button
                        class="action-button"
                        onclick="openCreateUserModal()"
                    >
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 15px;
                                padding: 20px;
                                background: #f8f9fa;
                                border-radius: 15px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            "
                        >
                            <div
                                style="
                                    width: 50px;
                                    height: 50px;
                                    background: linear-gradient(
                                        135deg,
                                        #28a745,
                                        #20c997
                                    );
                                    border-radius: 12px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-size: 1.5rem;
                                "
                            >
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div style="text-align: left">
                                <div style="font-weight: 600; color: #1a365d">
                                    Add User
                                </div>
                                <div style="font-size: 0.9rem; color: #666">
                                    Create new user account
                                </div>
                            </div>
                        </div>
                    </button>

                    <button class="action-button" onclick="generateReport()">
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 15px;
                                padding: 20px;
                                background: #f8f9fa;
                                border-radius: 15px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            "
                        >
                            <div
                                style="
                                    width: 50px;
                                    height: 50px;
                                    background: linear-gradient(
                                        135deg,
                                        #d4af37,
                                        #f7d154
                                    );
                                    border-radius: 12px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-size: 1.5rem;
                                "
                            >
                                <i class="fas fa-file-export"></i>
                            </div>
                            <div style="text-align: left">
                                <div style="font-weight: 600; color: #1a365d">
                                    Generate Report
                                </div>
                                <div style="font-size: 0.9rem; color: #666">
                                    Export system data
                                </div>
                            </div>
                        </div>
                    </button>

                    <button class="action-button" onclick="viewSystemLogs()">
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 15px;
                                padding: 20px;
                                background: #f8f9fa;
                                border-radius: 15px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            "
                        >
                            <div
                                style="
                                    width: 50px;
                                    height: 50px;
                                    background: linear-gradient(
                                        135deg,
                                        #6c757d,
                                        #adb5bd
                                    );
                                    border-radius: 12px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-size: 1.5rem;
                                "
                            >
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div style="text-align: left">
                                <div style="font-weight: 600; color: #1a365d">
                                    View Logs
                                </div>
                                <div style="font-size: 0.9rem; color: #666">
                                    System activity logs
                                </div>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div class="tab-content" id="usersTab">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">User Management</h2>
                    <div style="display: flex; gap: 15px">
                        <button
                            class="btn-secondary"
                            onclick="openCreateUserModal()"
                        >
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                        <button class="btn-primary" onclick="exportUsers()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 20px">
                    <input
                        type="text"
                        id="userSearch"
                        class="form-input"
                        placeholder="Search users by name or email..."
                        style="width: 100%"
                    />
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Age</th>
                            <th>Joined</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Users will be loaded here via JavaScript -->
                        <tr>
                            <td
                                colspan="6"
                                style="
                                    text-align: center;
                                    padding: 40px;
                                    color: #666;
                                "
                            >
                                <i
                                    class="fas fa-users"
                                    style="
                                        font-size: 2rem;
                                        margin-bottom: 15px;
                                        display: block;
                                    "
                                ></i>
                                Loading users...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rooms Tab -->
        <div class="tab-content" id="roomsTab">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Room Management</h2>
                    <div style="display: flex; gap: 15px">
                        <a
                            href="{{ url_for('create_room') }}"
                            class="btn-primary"
                        >
                            <i class="fas fa-plus"></i> Create Room
                        </a>
                        <button class="btn-secondary" onclick="refreshRooms()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Room Name</th>
                            <th>Location</th>
                            <th>Price</th>
                            <th>Capacity</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="roomsTableBody">
                        <!-- Rooms will be loaded here via JavaScript -->
                        <tr>
                            <td
                                colspan="6"
                                style="
                                    text-align: center;
                                    padding: 40px;
                                    color: #666;
                                "
                            >
                                <i
                                    class="fas fa-bed"
                                    style="
                                        font-size: 2rem;
                                        margin-bottom: 15px;
                                        display: block;
                                    "
                                ></i>
                                Loading rooms...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bookings Tab -->
        <div class="tab-content" id="bookingsTab">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Booking Management</h2>
                    <div style="display: flex; gap: 15px">
                        <button
                            class="btn-secondary"
                            onclick="filterBookingsByStatus('all')"
                        >
                            <i class="fas fa-list"></i> All
                        </button>
                        <button
                            class="btn-secondary"
                            onclick="filterBookingsByStatus('confirmed')"
                        >
                            <i class="fas fa-check"></i> Confirmed
                        </button>
                        <button
                            class="btn-secondary"
                            onclick="filterBookingsByStatus('pending')"
                        >
                            <i class="fas fa-clock"></i> Pending
                        </button>
                        <button class="btn-primary" onclick="refreshBookings()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Booking ID</th>
                            <th>Guest Name</th>
                            <th>Email</th>
                            <th>Check-in</th>
                            <th>Check-out</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingsTableBody">
                        <!-- Bookings will be loaded here via JavaScript -->
                        <tr>
                            <td
                                colspan="7"
                                style="
                                    text-align: center;
                                    padding: 40px;
                                    color: #666;
                                "
                            >
                                <i
                                    class="fas fa-calendar-alt"
                                    style="
                                        font-size: 2rem;
                                        margin-bottom: 15px;
                                        display: block;
                                    "
                                ></i>
                                Loading bookings...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- System Tab -->
        <div class="tab-content" id="systemTab">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">System Configuration</h2>
                </div>

                <div
                    style="
                        display: grid;
                        grid-template-columns: repeat(
                            auto-fit,
                            minmax(300px, 1fr)
                        );
                        gap: 25px;
                    "
                >
                    <!-- AWS Status -->
                    <div
                        style="
                            background: #f8f9fa;
                            padding: 25px;
                            border-radius: 15px;
                        "
                    >
                        <h3
                            style="
                                color: #1a365d;
                                margin-bottom: 20px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                            "
                        >
                            <i class="fab fa-aws" style="color: #ff9900"></i>
                            AWS Services Status
                        </h3>

                        <div
                            style="
                                display: flex;
                                flex-direction: column;
                                gap: 15px;
                            "
                        >
                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 12px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 10px;
                                    "
                                >
                                    <i
                                        class="fas fa-database"
                                        style="color: #2d9cdb"
                                    ></i>
                                    <span>DynamoDB</span>
                                </div>
                                <span
                                    id="dynamodbStatus"
                                    class="status-badge status-available"
                                >
                                    <i class="fas fa-check-circle"></i>
                                    Connected
                                </span>
                            </div>

                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 12px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 10px;
                                    "
                                >
                                    <i
                                        class="fas fa-bell"
                                        style="color: #d4af37"
                                    ></i>
                                    <span>SNS Notifications</span>
                                </div>
                                <span
                                    id="snsStatus"
                                    class="status-badge status-available"
                                >
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                            </div>

                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 12px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        display: flex;
                                        align-items: center;
                                        gap: 10px;
                                    "
                                >
                                    <i
                                        class="fas fa-server"
                                        style="color: #28a745"
                                    ></i>
                                    <span>EC2 Instance</span>
                                </div>
                                <span class="status-badge status-available">
                                    <i class="fas fa-check-circle"></i> Running
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings -->
                    <div
                        style="
                            background: #f8f9fa;
                            padding: 25px;
                            border-radius: 15px;
                        "
                    >
                        <h3 style="color: #1a365d; margin-bottom: 20px">
                            <i class="fas fa-cog"></i> System Settings
                        </h3>

                        <div
                            style="
                                display: flex;
                                flex-direction: column;
                                gap: 20px;
                            "
                        >
                            <div>
                                <label
                                    style="
                                        display: block;
                                        margin-bottom: 8px;
                                        font-weight: 600;
                                        color: #333;
                                    "
                                >
                                    <i class="fas fa-envelope"></i> Notification
                                    Settings
                                </label>
                                <div
                                    style="
                                        display: flex;
                                        flex-direction: column;
                                        gap: 10px;
                                    "
                                >
                                    <label
                                        style="
                                            display: flex;
                                            align-items: center;
                                            gap: 10px;
                                            cursor: pointer;
                                        "
                                    >
                                        <input type="checkbox" checked />
                                        <span>Enable email notifications</span>
                                    </label>
                                    <label
                                        style="
                                            display: flex;
                                            align-items: center;
                                            gap: 10px;
                                            cursor: pointer;
                                        "
                                    >
                                        <input type="checkbox" />
                                        <span>Enable SMS alerts</span>
                                    </label>
                                    <label
                                        style="
                                            display: flex;
                                            align-items: center;
                                            gap: 10px;
                                            cursor: pointer;
                                        "
                                    >
                                        <input type="checkbox" checked />
                                        <span>Send daily reports</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label
                                    style="
                                        display: block;
                                        margin-bottom: 8px;
                                        font-weight: 600;
                                        color: #333;
                                    "
                                >
                                    <i class="fas fa-shield-alt"></i> Security
                                    Settings
                                </label>
                                <div
                                    style="
                                        display: flex;
                                        flex-direction: column;
                                        gap: 10px;
                                    "
                                >
                                    <label
                                        style="
                                            display: flex;
                                            align-items: center;
                                            gap: 10px;
                                            cursor: pointer;
                                        "
                                    >
                                        <input type="checkbox" checked />
                                        <span>Require strong passwords</span>
                                    </label>
                                    <label
                                        style="
                                            display: flex;
                                            align-items: center;
                                            gap: 10px;
                                            cursor: pointer;
                                        "
                                    >
                                        <input type="checkbox" checked />
                                        <span
                                            >Enable two-factor
                                            authentication</span
                                        >
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button
                            class="btn-primary"
                            style="margin-top: 20px; width: 100%"
                            onclick="saveSystemSettings()"
                        >
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>

                <!-- System Logs -->
                <div style="margin-top: 30px">
                    <h3 style="color: #1a365d; margin-bottom: 20px">
                        <i class="fas fa-history"></i> Recent System Logs
                    </h3>

                    <div
                        style="
                            background: #f8f9fa;
                            padding: 20px;
                            border-radius: 15px;
                            max-height: 300px;
                            overflow-y: auto;
                        "
                    >
                        <div
                            style="
                                display: flex;
                                flex-direction: column;
                                gap: 15px;
                            "
                        >
                            <div
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    padding: 15px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        width: 40px;
                                        height: 40px;
                                        background: rgba(45, 156, 219, 0.1);
                                        border-radius: 10px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: #2d9cdb;
                                    "
                                >
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div style="flex: 1">
                                    <div style="font-weight: 600; color: #333">
                                        System started successfully
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666">
                                        Just now â€¢ Admin dashboard loaded
                                    </div>
                                </div>
                            </div>

                            <div
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    padding: 15px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        width: 40px;
                                        height: 40px;
                                        background: rgba(40, 167, 69, 0.1);
                                        border-radius: 10px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: #28a745;
                                    "
                                >
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div style="flex: 1">
                                    <div style="font-weight: 600; color: #333">
                                        New user registered
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666">
                                        5 minutes ago â€¢ John Guest (guest)
                                    </div>
                                </div>
                            </div>

                            <div
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    padding: 15px;
                                    background: white;
                                    border-radius: 10px;
                                "
                            >
                                <div
                                    style="
                                        width: 40px;
                                        height: 40px;
                                        background: rgba(255, 193, 7, 0.1);
                                        border-radius: 10px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: #856404;
                                    "
                                >
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div style="flex: 1">
                                    <div style="font-weight: 600; color: #333">
                                        AWS connection attempt failed
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666">
                                        10 minutes ago â€¢ Falling back to mock
                                        database
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button
                        class="btn-text"
                        style="margin-top: 15px"
                        onclick="viewAllLogs()"
                    >
                        <i class="fas fa-list"></i> View All Logs
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div class="modal" id="createUserModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New User</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div id="createUserForm">
            <!-- Form will be loaded here via JavaScript -->
        </div>
    </div>
</div>

<div class="modal" id="confirmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="confirmTitle">Confirm Action</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div id="confirmMessage" style="margin-bottom: 30px">
            <!-- Message will be loaded here -->
        </div>
        <div style="display: flex; gap: 15px; justify-content: flex-end">
            <button class="btn-secondary" onclick="closeModal()">Cancel</button>
            <button class="btn-primary" id="confirmAction">Confirm</button>
        </div>
    </div>
</div>

<div class="modal" id="systemLogsModal">
    <div class="modal-content" style="max-width: 800px; max-height: 80vh">
        <div class="modal-header">
            <h3><i class="fas fa-clipboard-list"></i> System Activity Logs</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div id="systemLogsContent" style="max-height: 500px; overflow-y: auto">
            <!-- Logs will be loaded here via JavaScript -->
        </div>
    </div>
</div>
{% endblock %} {% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Tab functionality
        const tabs = document.querySelectorAll(".dashboard-tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => {
            tab.addEventListener("click", function () {
                // Update active tab
                tabs.forEach((t) => t.classList.remove("active"));
                this.classList.add("active");

                // Show corresponding content
                const tabId = this.getAttribute("data-tab");
                tabContents.forEach((content) => {
                    content.classList.remove("active");
                    if (content.id === tabId + "Tab") {
                        content.classList.add("active");
                    }
                });

                // Load data for the tab
                switch (tabId) {
                    case "users":
                        loadUsers();
                        break;
                    case "rooms":
                        loadRooms();
                        break;
                    case "bookings":
                        loadBookings();
                        break;
                }
            });
        });

        // Initialize with overview tab active
        tabs[0].click();

        // User search functionality
        const userSearch = document.getElementById("userSearch");
        if (userSearch) {
            userSearch.addEventListener("input", function () {
                filterUsers(this.value);
            });
        }
    });

    function refreshAnalytics() {
        showToast("Refreshing analytics data...", "info");

        // Simulate API call
        setTimeout(() => {
            showToast("Analytics data updated", "success");
            // In a real application, you would fetch new data from the server
        }, 1000);
    }

    function loadUsers() {
        const usersTableBody = document.getElementById("usersTableBody");
        if (!usersTableBody) return;

        usersTableBody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    Loading users...
                </td>
            </tr>
        `;

        // Debug log
        console.log("Fetching users from /api/users");

        // Real API call
        fetch("/api/users")
            .then((response) => {
                console.log("Response status:", response.status);
                return response.json();
            })
            .then((data) => {
                console.log("API Response:", data);
                if (data.success && data.users) {
                    updateUsersTable(data.users);
                } else {
                    console.error("API Error:", data.error);
                    usersTableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: red;">Error: ${data.error || "No users found"}</td></tr>`;
                }
            })
            .catch((error) => {
                console.error("Fetch Error:", error);
                usersTableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: red;">Error: ${error.message}</td></tr>`;
            });
    }

    function updateUsersTable(users) {
        const usersTableBody = document.getElementById("usersTableBody");
        if (!usersTableBody) return;

        console.log(`Updating table with ${users.length} users`);

        if (!users || users.length === 0) {
            usersTableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-user-slash" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        No users found. Create a new user using "Add User" button.
                    </td>
                </tr>
            `;
            return;
        }

        let html = "";
        users.forEach((user) => {
            const roleColor =
                user.role === "admin"
                    ? "#dc3545"
                    : user.role === "staff"
                      ? "#ffc107"
                      : "#28a745";

            const joinedDate = user.joined || user.created_at || "N/A";

            html += `
                <tr>
                    <td style="font-weight: 600; color: #1a365d;">${user.name || "N/A"}</td>
                    <td>${user.email || "N/A"}</td>
                    <td>
                        <span style="display: inline-flex; align-items: center; gap: 5px; padding: 4px 12px; background: ${roleColor}15; color: ${roleColor}; border-radius: 50px; font-size: 0.85rem; font-weight: 600;">
                            <i class="fas fa-user"></i>
                            ${(user.role || "guest").toUpperCase()}
                        </span>
                    </td>
                    <td>${user.age || "N/A"}</td>
                    <td>${joinedDate}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" onclick="editUser('${user.user_id || user.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon" onclick="deleteUser('${user.user_id || user.id}', '${user.name || "User"}')" title="Delete" style="color: #dc3545;">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-icon" onclick="resetPassword('${user.user_id || user.id}', '${user.name || "User"}')" title="Reset Password">
                                <i class="fas fa-key"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });

        usersTableBody.innerHTML = html;
    }

    function filterUsers(searchTerm) {
        // In a real application, you would make an API call
        // For now, we'll just reload the data
        loadUsers();
    }

    function loadRooms() {
        const roomsTableBody = document.getElementById("roomsTableBody");
        if (!roomsTableBody) return;

        roomsTableBody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    Loading rooms...
                </td>
            </tr>
        `;

        // Real API call
        fetch("/api/rooms")
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    updateRoomsTable(data.rooms);
                } else {
                    roomsTableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: red;">Error loading rooms</td></tr>`;
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                roomsTableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: red;">Error loading rooms</td></tr>`;
            });
    }

    function updateRoomsTable(rooms) {
        const roomsTableBody = document.getElementById("roomsTableBody");
        if (!roomsTableBody) return;

        if (rooms.length === 0) {
            roomsTableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-bed" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        No rooms found
                    </td>
                </tr>
            `;
            return;
        }

        let html = "";
        rooms.forEach((room) => {
            const statusColor =
                room.status === "available" ? "#28a745" : "#dc3545";

            // Format price safely
            const formattedPrice =
                typeof room.price === "number"
                    ? (room.price / 1).toFixed(2)
                    : "0.00";

            html += `
                <tr>
                    <td style="font-weight: 600; color: #1a365d;">${room.name}</td>
                    <td>${room.location}</td>
                    <td style="color: #d4af37; font-weight: 600;">â‚¹${formattedPrice}</td>
                    <td>${room.capacity} guests</td>
                    <td>
                        <span style="display: inline-flex; align-items: center; gap: 5px; padding: 4px 12px; background: ${statusColor}15; color: ${statusColor}; border-radius: 50px; font-size: 0.85rem; font-weight: 600;">
                            <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                            ${room.status.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="/room/${room.id}/edit" class="btn-icon" title="Edit Room">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn-icon" onclick="deleteRoom('${room.id}', '${room.name}')" title="Delete" style="color: #dc3545;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });

        roomsTableBody.innerHTML = html;
    }

    function refreshRooms() {
        showToast("Refreshing room data...", "info");
        loadRooms();
    }

    function openCreateUserModal() {
        const modal = document.getElementById("createUserModal");
        const formContainer = document.getElementById("createUserForm");

        formContainer.innerHTML = `
            <form onsubmit="createNewUser(event)">
                <div class="form-group">
                    <label for="newUserName">Full Name *</label>
                    <input type="text" id="newUserName" class="form-input" placeholder="John Doe" required>
                </div>

                <div class="form-group">
                    <label for="newUserEmail">Email Address *</label>
                    <input type="email" id="newUserEmail" class="form-input" placeholder="john@example.com" required>
                </div>

                <div class="form-group">
                    <label for="newUserRole">Role *</label>
                    <select id="newUserRole" class="form-input" required>
                        <option value="guest">Guest</option>
                        <option value="staff">Staff</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="newUserAge">Age *</label>
                    <input type="number" id="newUserAge" class="form-input" min="18" max="120" placeholder="25" required>
                </div>

                <div class="form-group">
                    <label for="newUserPassword">Password *</label>
                    <input type="password" id="newUserPassword" class="form-input" placeholder="Create a password" required>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Password will be sent to the user via email
                    </small>
                </div>

                <div class="form-actions" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create User</button>
                </div>
            </form>
        `;

        modal.classList.add("show");
    }

    function createNewUser(event) {
        event.preventDefault();

        const name = document.getElementById("newUserName").value;
        const email = document.getElementById("newUserEmail").value;
        const role = document.getElementById("newUserRole").value;
        const age = document.getElementById("newUserAge").value;
        const password = document.getElementById("newUserPassword").value;

        const formData = new FormData();
        formData.append("name", name);
        formData.append("email", email);
        formData.append("role", role);
        formData.append("age", age);
        formData.append("password", password);

        showToast(`Creating ${role} account for ${name}...`, "info");

        fetch("/api/users", {
            method: "POST",
            body: formData,
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast(`User ${name} created successfully!`, "success");
                    closeModal();
                    loadUsers();
                } else {
                    showToast(data.error || "Error creating user", "danger");
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                showToast("Error creating user", "danger");
            });
    }

    function editUser(userId) {
        openEditUserModal(userId);
    }

    function openEditUserModal(userId) {
        const modal = document.getElementById("createUserModal");
        const formContainer = document.getElementById("createUserForm");

        formContainer.innerHTML = `
      <div style="text-align:center; padding: 20px; color:#666;">
        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
        Loading user...
      </div>
    `;
        modal.classList.add("show");

        fetch(`/api/user/${userId}`)
            .then((r) => r.json())
            .then((data) => {
                if (!data.success || !data.user) {
                    showToast(data.error || "Error loading user", "danger");
                    closeModal();
                    return;
                }

                const user = data.user;

                formContainer.innerHTML = `
          <form onsubmit="updateExistingUser(event, '${userId}')">
            <div class="form-group">
              <label for="editUserName">Full Name *</label>
              <input type="text" id="editUserName" class="form-input" value="${(user.name || "").replaceAll('"', "&quot;")}" required>
            </div>

            <div class="form-group">
              <label for="editUserEmail">Email Address *</label>
              <input type="email" id="editUserEmail" class="form-input" value="${(user.email || "").replaceAll('"', "&quot;")}" required>
            </div>

            <div class="form-group">
              <label for="editUserRole">Role *</label>
              <select id="editUserRole" class="form-input" required>
                <option value="guest" ${user.role === "guest" ? "selected" : ""}>Guest</option>
                <option value="staff" ${user.role === "staff" ? "selected" : ""}>Staff</option>
                <option value="admin" ${user.role === "admin" ? "selected" : ""}>Admin</option>
                <option value="branch_staff" ${user.role === "branch_staff" ? "selected" : ""}>Branch Staff</option>
                <option value="branch_manager" ${user.role === "branch_manager" ? "selected" : ""}>Branch Manager</option>
                <option value="super_admin" ${user.role === "super_admin" ? "selected" : ""}>Super Admin</option>
              </select>
            </div>

            <div class="form-group">
              <label for="editUserAge">Age *</label>
              <input type="number" id="editUserAge" class="form-input" min="18" max="120" value="${user.age || 18}" required>
            </div>

            <div class="form-group">
              <label for="editUserPhone">Phone</label>
              <input type="text" id="editUserPhone" class="form-input" value="${(user.phone || "").replaceAll('"', "&quot;")}" placeholder="+91-98765-43210">
            </div>

            <div class="form-group">
              <label for="editUserPassword">New Password (leave blank to keep)</label>
              <input type="password" id="editUserPassword" class="form-input" placeholder="New password">
            </div>

            <div class="form-actions" style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
              <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
              <button type="submit" class="btn-primary">Save Changes</button>
            </div>
          </form>
        `;
            })
            .catch((err) => {
                console.error(err);
                showToast("Error loading user", "danger");
                closeModal();
            });
    }

    function updateExistingUser(event, userId) {
        event.preventDefault();

        const name = document.getElementById("editUserName").value;
        const email = document.getElementById("editUserEmail").value;
        const role = document.getElementById("editUserRole").value;
        const age = document.getElementById("editUserAge").value;
        const phone = document.getElementById("editUserPhone").value;
        const password = document.getElementById("editUserPassword").value;

        const payload = { name, email, role, age, phone };
        if (password && password.trim()) payload.password = password.trim();

        showToast("Saving user changes...", "info");

        fetch(`/api/user/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
        })
            .then((r) => r.json())
            .then((data) => {
                if (data.success) {
                    showToast("User updated successfully!", "success");
                    closeModal();
                    loadUsers();
                } else {
                    showToast(data.error || "Error updating user", "danger");
                }
            })
            .catch((err) => {
                console.error(err);
                showToast("Error updating user", "danger");
            });
    }

    function deleteUser(userId, userName) {
        const modal = document.getElementById("confirmModal");
        const title = document.getElementById("confirmTitle");
        const message = document.getElementById("confirmMessage");
        const actionBtn = document.getElementById("confirmAction");

        title.textContent = "Delete User";
        message.innerHTML = `
            <p>Are you sure you want to delete <strong>${userName}</strong>?</p>
            <p style="color: #666; margin-top: 10px;">
                <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                This action cannot be undone.
            </p>
        `;

        actionBtn.onclick = function () {
            showToast(`Deleting user ${userName}...`, "info");

            fetch(`/api/user/${userId}`, { method: "DELETE" })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        showToast(`User deleted successfully`, "success");
                        closeModal();
                        loadUsers();
                    } else {
                        showToast(
                            data.error || "Error deleting user",
                            "danger",
                        );
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                    showToast("Error deleting user", "danger");
                });
        };

        actionBtn.textContent = "Delete User";
        actionBtn.className = "btn-danger";
        modal.classList.add("show");
    }

    function resetPassword(userId, userName) {
        showToast(`Resetting password for ${userName}...`, "info");

        // Simulate API call
        setTimeout(() => {
            showToast(`Password reset email sent to ${userName}`, "success");
        }, 1500);
    }

    function editRoom(roomId) {
        showToast(`Editing room ${roomId}...`, "info");
        // In a real application, open edit modal or redirect
    }

    function deleteRoom(roomId, roomName) {
        const modal = document.getElementById("confirmModal");
        const title = document.getElementById("confirmTitle");
        const message = document.getElementById("confirmMessage");
        const actionBtn = document.getElementById("confirmAction");

        title.textContent = "Delete Room";
        message.innerHTML = `
            <p>Are you sure you want to delete <strong>${roomName}</strong>?</p>
            <p style="color: #666; margin-top: 10px;">
                <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                This action cannot be undone.
            </p>
        `;

        actionBtn.onclick = function () {
            showToast(`Deleting room ${roomName}...`, "info");

            fetch(`/api/room/${roomId}`, { method: "DELETE" })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        showToast(`Room deleted successfully`, "success");
                        closeModal();
                        loadRooms();
                    } else {
                        showToast(
                            data.error || "Error deleting room",
                            "danger",
                        );
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                    showToast("Error deleting room", "danger");
                });
        };

        actionBtn.textContent = "Delete Room";
        actionBtn.className = "btn-danger";
        modal.classList.add("show");
    }

    function generateReport() {
        showToast("Generating system report with actual data...", "info");

        // Call actual API endpoint
        fetch("/api/admin/generate-report")
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to generate report");
                }
                return response.blob();
            })
            .then((blob) => {
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download =
                    "blissful-abodes-report-" +
                    new Date().toISOString().split("T")[0] +
                    ".pdf";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);

                showToast(
                    "Report generated successfully! Download started.",
                    "success",
                );
            })
            .catch((error) => {
                console.error("Error generating report:", error);
                showToast(
                    "Error generating report. Please try again.",
                    "danger",
                );
            });
    }

    function viewSystemLogs() {
        const modal = document.getElementById("systemLogsModal");
        const logsContent = document.getElementById("systemLogsContent");

        // Generate comprehensive system logs
        const logs = [
            {
                icon: "fa-check-circle",
                color: "#28a745",
                bgColor: "rgba(40, 167, 69, 0.1)",
                title: "System Started",
                description: "Admin dashboard loaded successfully",
                time: "Just now",
            },
            {
                icon: "fa-user-plus",
                color: "#2d9cdb",
                bgColor: "rgba(45, 156, 219, 0.1)",
                title: "User Activity",
                description: `Admin ${session.user?.name || "User"} logged in`,
                time: "2 minutes ago",
            },
            {
                icon: "fa-database",
                color: "#d4af37",
                bgColor: "rgba(212, 175, 55, 0.1)",
                title: "Database Connection",
                description: "Successfully connected to DynamoDB",
                time: "5 minutes ago",
            },
            {
                icon: "fa-sync",
                color: "#2d9cdb",
                bgColor: "rgba(45, 156, 219, 0.1)",
                title: "Data Sync",
                description: "User and room data synchronized",
                time: "10 minutes ago",
            },
            {
                icon: "fa-calendar-check",
                color: "#28a745",
                bgColor: "rgba(40, 167, 69, 0.1)",
                title: "New Booking",
                description: "Booking confirmed for Deluxe Room",
                time: "15 minutes ago",
            },
            {
                icon: "fa-bell",
                color: "#ffc107",
                bgColor: "rgba(255, 193, 7, 0.1)",
                title: "Notification Sent",
                description: "Confirmation email sent to guest",
                time: "20 minutes ago",
            },
            {
                icon: "fa-shield-alt",
                color: "#28a745",
                bgColor: "rgba(40, 167, 69, 0.1)",
                title: "Security Check",
                description: "All security protocols verified",
                time: "30 minutes ago",
            },
            {
                icon: "fa-server",
                color: "#2d9cdb",
                bgColor: "rgba(45, 156, 219, 0.1)",
                title: "Server Health",
                description: "System health check passed",
                time: "1 hour ago",
            },
            {
                icon: "fa-chart-line",
                color: "#d4af37",
                bgColor: "rgba(212, 175, 55, 0.1)",
                title: "Analytics Update",
                description: "Daily analytics report generated",
                time: "2 hours ago",
            },
            {
                icon: "fa-cloud-upload-alt",
                color: "#2d9cdb",
                bgColor: "rgba(45, 156, 219, 0.1)",
                title: "Backup Completed",
                description: "Automated backup to AWS S3 successful",
                time: "3 hours ago",
            },
        ];

        let html =
            '<div style="display: flex; flex-direction: column; gap: 15px; padding: 20px;">';

        logs.forEach((log) => {
            html += `
                <div style="
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    padding: 15px;
                    background: white;
                    border-radius: 10px;
                    border-left: 4px solid ${log.color};
                    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                ">
                    <div style="
                        width: 45px;
                        height: 45px;
                        background: ${log.bgColor};
                        border-radius: 10px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: ${log.color};
                        flex-shrink: 0;
                    ">
                        <i class="fas ${log.icon}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #1a365d; margin-bottom: 4px;">
                            ${log.title}
                        </div>
                        <div style="font-size: 0.9rem; color: #666;">
                            ${log.description}
                        </div>
                    </div>
                    <div style="font-size: 0.85rem; color: #999; white-space: nowrap;">
                        ${log.time}
                    </div>
                </div>
            `;
        });

        html += "</div>";

        logsContent.innerHTML = html;
        modal.classList.add("show");
        showToast("Displaying system activity logs", "info");
    }

    function exportUsers() {
        showToast("Exporting user data...", "info");

        // Call actual API endpoint
        fetch("/api/admin/export-users")
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to export users");
                }
                return response.blob();
            })
            .then((blob) => {
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download =
                    "blissful-abodes-users-" +
                    new Date().toISOString().split("T")[0] +
                    ".csv";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);

                showToast("User data exported successfully!", "success");
            })
            .catch((error) => {
                console.error("Error exporting users:", error);
                showToast("Error exporting users. Please try again.", "danger");
            });
    }

    function saveSystemSettings() {
        showToast("Saving system settings...", "info");

        // Simulate API call
        setTimeout(() => {
            showToast("System settings saved successfully!", "success");
        }, 1000);
    }

    function viewAllLogs() {
        showToast("Loading all system logs...", "info");
        // In a real application, navigate to logs page
    }

    function closeModal() {
        const modals = document.querySelectorAll(".modal");
        modals.forEach((modal) => {
            modal.classList.remove("show");
        });
    }

    // Close modal when clicking outside
    document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", function (e) {
            if (e.target === this) {
                closeModal();
            }
        });
    });

    // Check AWS status
    function checkAWSStatus() {
        const dynamodbStatus = document.getElementById("dynamodbStatus");
        const snsStatus = document.getElementById("snsStatus");

        if (dynamodbStatus && snsStatus) {
            // In a real application, you would make an API call to check status
            // For now, we'll simulate based on console output
            dynamodbStatus.innerHTML =
                '<i class="fas fa-exclamation-triangle"></i> Mock Mode';
            dynamodbStatus.className = "status-badge status-warning";

            snsStatus.innerHTML =
                '<i class="fas fa-exclamation-triangle"></i> Mock Mode';
            snsStatus.className = "status-badge status-warning";
        }
    }

    // Initialize AWS status check
    setTimeout(checkAWSStatus, 1000);

    function loadBookings() {
        const bookingsTableBody = document.getElementById("bookingsTableBody");
        if (!bookingsTableBody) return;

        bookingsTableBody.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    Loading bookings...
                </td>
            </tr>
        `;

        // Real API call
        fetch("/api/bookings")
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    updateBookingsTable(data.bookings);
                } else {
                    bookingsTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: red;">Error loading bookings</td></tr>`;
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                bookingsTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: red;">Error loading bookings</td></tr>`;
            });
    }

    function updateBookingsTable(bookings) {
        const bookingsTableBody = document.getElementById("bookingsTableBody");
        if (!bookingsTableBody) return;

        if (bookings.length === 0) {
            bookingsTableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        No bookings found
                    </td>
                </tr>
            `;
            return;
        }

        let html = "";
        bookings.forEach((booking) => {
            const statusColor =
                booking.status === "confirmed"
                    ? "#28a745"
                    : booking.status === "pending"
                      ? "#ffc107"
                      : "#dc3545";

            html += `
                <tr data-booking-id="${booking.booking_id}" data-status="${booking.status}">
                    <td style="font-weight: 600; color: #1a365d;">${booking.booking_id.slice(0, 8)}</td>
                    <td>${booking.guest_name}</td>
                    <td>${booking.guest_email}</td>
                    <td>${booking.check_in}</td>
                    <td>${booking.check_out}</td>
                    <td>
                        <span style="display: inline-flex; align-items: center; gap: 5px; padding: 4px 12px; background: ${statusColor}15; color: ${statusColor}; border-radius: 50px; font-size: 0.85rem; font-weight: 600;">
                            <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                            ${booking.status.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" onclick="viewBooking('${booking.booking_id}')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="updateBookingStatus('${booking.booking_id}', 'confirmed')" title="Confirm">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon" onclick="cancelBooking('${booking.booking_id}', '${booking.guest_name}')" title="Cancel" style="color: #dc3545;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        });

        bookingsTableBody.innerHTML = html;
    }

    function refreshBookings() {
        showToast("Refreshing bookings...", "info");
        loadBookings();
    }

    function filterBookingsByStatus(status) {
        const rows = document.querySelectorAll(
            "#bookingsTableBody tr[data-booking-id]",
        );
        rows.forEach((row) => {
            if (
                status === "all" ||
                row.getAttribute("data-status") === status
            ) {
                row.style.display = "table-row";
            } else {
                row.style.display = "none";
            }
        });
    }

    function viewBooking(bookingId) {
        showToast(`Loading booking ${bookingId}...`, "info");
        // In a real application, open modal with booking details
    }

    function updateBookingStatus(bookingId, newStatus) {
        showToast(`Updating booking status to ${newStatus}...`, "info");

        fetch(`/api/booking/${bookingId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status: newStatus }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("Booking updated successfully!", "success");
                    loadBookings();
                } else {
                    showToast(data.error || "Error updating booking", "danger");
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                showToast("Error updating booking", "danger");
            });
    }

    function cancelBooking(bookingId, guestName) {
        const modal = document.getElementById("confirmModal");
        const title = document.getElementById("confirmTitle");
        const message = document.getElementById("confirmMessage");
        const actionBtn = document.getElementById("confirmAction");

        title.textContent = "Cancel Booking";
        message.innerHTML = `
            <p>Are you sure you want to cancel booking for <strong>${guestName}</strong>?</p>
            <p style="color: #666; margin-top: 10px;">
                <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                A cancellation email will be sent to the guest.
            </p>
        `;

        actionBtn.onclick = function () {
            showToast(`Cancelling booking...`, "info");

            fetch(`/api/booking/${bookingId}`, { method: "DELETE" })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        showToast(`Booking cancelled successfully`, "success");
                        closeModal();
                        loadBookings();
                    } else {
                        showToast(
                            data.error || "Error cancelling booking",
                            "danger",
                        );
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                    showToast("Error cancelling booking", "danger");
                });
        };

        actionBtn.textContent = "Cancel Booking";
        actionBtn.className = "btn-danger";
        modal.classList.add("show");
    }

    // Toast notification function
    function showToast(message, type = "info") {
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById("toast-container");
        if (!toastContainer) {
            toastContainer = document.createElement("div");
            toastContainer.id = "toast-container";
            toastContainer.style.cssText =
                "position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px;";
            document.body.appendChild(toastContainer);
        }

        // Create toast element
        const toast = document.createElement("div");
        toast.style.cssText = `
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 300px;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        `;

        // Set color based on type
        const colors = {
            success: "#28a745",
            danger: "#dc3545",
            warning: "#ffc107",
            info: "#2d9cdb",
        };
        toast.style.background = colors[type] || colors.info;

        // Set icon based on type
        const icons = {
            success: "fa-check-circle",
            danger: "fa-exclamation-circle",
            warning: "fa-exclamation-triangle",
            info: "fa-info-circle",
        };
        const icon = icons[type] || icons.info;

        toast.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
        toastContainer.appendChild(toast);

        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.style.animation = "slideOut 0.3s ease";
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // Add CSS animations for toast
    if (!document.getElementById("toast-styles")) {
        const style = document.createElement("style");
        style.id = "toast-styles";
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    }

    // Create Room Modal function
    function openCreateRoomModal() {
        // Redirect to create room page
        window.location.href = "{{ url_for('create_room') }}";
    }

    // Initialize Charts
    function initializeCharts() {
        // User Growth Chart
        const userCtx = document.getElementById('userGrowthChart');
        if (userCtx) {
            new Chart(userCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Total Users',
                        data: [12, 19, 25, 32, 45, {% if analytics and analytics.get('users') %}{{ analytics.get('users', {}).get('total', 50) }}{% else %}50{% endif %}],
                        borderColor: '#2d9cdb',
                        backgroundColor: 'rgba(45, 156, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
        }

        // Booking Trends Chart
        const bookingCtx = document.getElementById('bookingTrendsChart');
        if (bookingCtx) {
            new Chart(bookingCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Bookings',
                        data: [12, 19, 15, 25, 22, 30, {% if analytics and analytics.get('bookings') %}{{ analytics.get('bookings', {}).get('total', 28) }}{% else %}28{% endif %}],
                        backgroundColor: [
                            'rgba(212, 175, 55, 0.8)',
                            'rgba(45, 156, 219, 0.8)',
                            'rgba(26, 54, 93, 0.8)',
                            'rgba(212, 175, 55, 0.8)',
                            'rgba(45, 156, 219, 0.8)',
                            'rgba(26, 54, 93, 0.8)',
                            'rgba(212, 175, 55, 0.8)'
                        ],
                        borderColor: [
                            '#d4af37',
                            '#2d9cdb',
                            '#1a365d',
                            '#d4af37',
                            '#2d9cdb',
                            '#1a365d',
                            '#d4af37'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 5
                            }
                        }
                    }
                }
            });
        }
    }

    // Initialize charts when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Load Chart.js from CDN
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js';
        script.onload = function() {
            initializeCharts();
        };
        document.head.appendChild(script);
    });
</script>
{% endblock %}
